{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/Infrastructure/github_container_registory_basic/","result":{"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"ea34177a-8576-51ee-987a-f420218ba628","excerpt":"GitHub レポジトリ作成 .gitignore 設置 (任意) .GitHub/workflows/build.yml 設置 (空でよい) 初期コミット、Push をしておく。 PERSONAL_ACCESS_TOKEN が必要なので発行する GitHub…","html":"<h2>GitHub レポジトリ作成</h2>\n<ul>\n<li>.gitignore 設置 (任意)</li>\n<li>.GitHub/workflows/build.yml 設置 (空でよい)</li>\n<li>初期コミット、Push をしておく。</li>\n</ul>\n<h2>PERSONAL_ACCESS_TOKEN が必要なので発行する</h2>\n<ul>\n<li>GitHub 個人の設定の <code class=\"language-text\">Settings</code> -> <code class=\"language-text\">Developer settings</code> -> <code class=\"language-text\">Personal access tokens</code></li>\n</ul>\n<p>この値をメモる</p>\n<h2>PERSONAL_ACCESS_TOKEN を Secret に設定する</h2>\n<ul>\n<li><code class=\"language-text\">Repository</code> -> <code class=\"language-text\">Settings</code> -> <code class=\"language-text\">Secret</code><br>\npullDown の <code class=\"language-text\">actions</code> を 選択<br>\nここで任意の名前で設定する (ここでは <code class=\"language-text\">PERSONAL_ACCESS_TOKEN</code> で 設定)</li>\n</ul>\n<h2>USERNAME を Secret に設定する</h2>\n<p>workflow の 下記</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">ghcr.io/$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>/$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> env.IMAGE_NAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>latest</code></pre></div>\n<p><code class=\"language-text\">アカウント名は lowercase でないといけない</code> と怒られるので明示的に secrets へ小文字でアカウント名を登録</p>\n<ul>\n<li><code class=\"language-text\">Repository</code> -> <code class=\"language-text\">Settings</code> -> <code class=\"language-text\">Secret</code><br>\npullDown の <code class=\"language-text\">actions</code> を 選択<br>\nここで任意の名前で設定する (ここでは <code class=\"language-text\">USERNAME</code> で 設定)</li>\n</ul>\n<h2>GitHub Actions workflow を作成</h2>\n<p><a href=\"https://qiita.com/kawakawaryuryu/items/b0291c1bc1141a535263\">参考</a></p>\n<p><code class=\"language-text\">.github/workflows/build.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and Publish Docker\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build_and_push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">IMAGE_NAME</span><span class=\"token punctuation\">:</span> linkchecker\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Docker Buildx\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/setup<span class=\"token punctuation\">-</span>buildx<span class=\"token punctuation\">-</span>action@v1\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to GitHub Container Registry\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span> ghcr.io\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.PERSONAL_ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> ./\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ghcr.io/${{ secrets.USERNAME }}/${{ env.IMAGE_NAME }}:latest\n            ghcr.io/${{ secrets.USERNAME }}/${{ env.IMAGE_NAME }}:1.0.0</span>\n</code></pre></div>\n<h2>レポジトリへプッシュ</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> poush origin main</code></pre></div>\n<p>Build がうまく行けば <code class=\"language-text\">https://github.com/&lt;&lt;YOUR_ACCOUNT>>?tab=packages</code> に DockerImage が生成されている</p>","frontmatter":{"title":"Docker Image を GitHubAction からGHCR (GitHub Container Repository) へPush","date":"March 06, 2022","post_modified":"March 06, 2022","description":"GitHub Actions 内で Dockerfile をもとに Build し GHCR (GitHub Container Repository) へPush。 今後の可能性を多々感じる。アイデア次第でとても効率的に。","tags":["GitHub","GitHub Actions","ghcr.io"],"draft":false}},"previous":{"fields":{"slug":"/FrontEnd/GatsbyJS/gatsby-plugin-styled-components/"},"frontmatter":{"title":"GatsbyJS で 初回表示、リロード時にスタイルが崩れる"}},"next":{"fields":{"slug":"/FrontEnd/GatsbyJS/gatsby_search/"},"frontmatter":{"title":"GatsbyJS 検索ページを設置 sessionStorage 使用しページ遷移しても検索結果を保持"}}},"pageContext":{"id":"ea34177a-8576-51ee-987a-f420218ba628","previousPostId":"8b30211a-80ad-58b7-94a8-5694db46180d","nextPostId":"f4e1f660-e1ee-5405-a88c-44703d163067","draft":false}},"staticQueryHashes":["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575","3679674316"]}
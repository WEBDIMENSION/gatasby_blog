{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/FrontEnd/Topics/GatsbyJS/100_deploy/",
    "result": {"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"ffad8e40-921c-587f-8bfc-fa9220aa67c7","excerpt":"問い合わせフォームはFlexyFormを選定したので Deploy 先のホスティングサービスは限定されずにすむ。 せっかくなので GitHub Actions を設定して簡易的な CI/CD を導入する。 GatsbyJS の Deploy 前提 GitHub レポジトリ使用 GitHub Actions…","html":"<p>問い合わせフォームは<a href=\"https://www.flexyform.com\">FlexyForm</a>を選定したので Deploy 先のホスティングサービスは限定されずにすむ。</p>\n<p>せっかくなので GitHub Actions を設定して簡易的な CI/CD を導入する。</p>\n<h2>GatsbyJS の Deploy 前提</h2>\n<ul>\n<li>GitHub レポジトリ使用</li>\n<li>GitHub Actions 使用</li>\n<li>Deploy 先は GitHub Page 使用</li>\n<li>独自ドメインでアクセスできるようにする blog.xxxxxx.com のようにサブドメインを設定する。</li>\n</ul>\n<h2>GitHub Actions の設定</h2>\n<p>workflow を作成<br>\n今回は <code class=\"language-text\">dploy.yml</code> とする。<br>\nトップディレクトリから\n<code class=\"language-text\">.github/workflows/deploy.yml</code> を新規作成<br>\nちなみに <code class=\"language-text\">.github/README.md</code> を作成すればレポジトリの README として扱われる。</p>\n<p><code class=\"language-text\">.github/workflows/deploy.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span><span class=\"token number\">20.04</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup Node\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"14.x\"</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Yarn\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token punctuation\">-</span>g yarn\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Cache dependencies\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ~/.cache/yarn\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>yarn<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> hashFiles('<span class=\"token important\">**/yarn.lock')</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">restore-keys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{ runner.os }}-yarn-</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install dependencies\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn install\n        <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run build\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.ref == 'refs/heads/master' <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">SITE_URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>secrets.SITE_URL<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn build\n        <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token tag\">!env.ACT</span> <span class=\"token important\">&amp;&amp;</span> github.ref == 'refs/heads/master'<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ls public Dir\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> ls <span class=\"token punctuation\">-</span>la public\n        <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./</code></pre></div>\n<h2>GitHub レポジトリの設定</h2>\n<ul>\n<li>レポジトリ名は YOUR_ACCOUNT.github.io にする。</li>\n<li>project を master に push する</li>\n<li>GitHub Actions が起動する</li>\n<li>GitHub Pages の設定画面で branch のプルダウンから gh-pages を選択</li>\n<li>Deploy 後は YOUR_ACCOUNT.github.io でアクセスできる</li>\n</ul>\n<h2>独自ドメイン設定</h2>\n<p>DNS レコードの CNAME で対応する</p>\n<table>\n<thead>\n<tr>\n<th>エントリ名</th>\n<th>タイプ</th>\n<th>データ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>blog</td>\n<td>CNAME</td>\n<td>YOUR_ACCOUNT.github.io</td>\n</tr>\n</tbody>\n</table>\n<p>GitHub Pages の設定画面の Custom domain で blog.xxxx.com (Your domain) を設定</p>\n<p>SSL (Let’s Encrypt) の反映等少々時間を要す。</p>","frontmatter":{"title":"GatsbyJS の CI/CD","date":"March 02, 2022","post_modified":"March 02, 2022","description":"GatsbyJS の CI/CD。GitHub Actionを使用してGitHub Pageへデプロイ。独自ドメイン設定","tags":["GatsbyJS","TypeScript"],"draft":false}},"previous":{"fields":{"slug":"/FrontEnd/Topics/GatsbyJS/010_favicon/"},"frontmatter":{"title":"GatsbyJs の Fabcon.ico を変更"}},"next":{"fields":{"slug":"/FrontEnd/Topics/GatsbyJS/999_last/"},"frontmatter":{"title":"GatsbyJS で Blog 構築するための下地作りを終えて"}}},"pageContext":{"id":"ffad8e40-921c-587f-8bfc-fa9220aa67c7","previousPostId":"acae5d29-2b7e-5152-b546-9d9452dda42a","nextPostId":"6762bc84-4007-56ee-ae60-677f0ce1542b","draft":false}},
    "staticQueryHashes": ["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575","3679674316"]}
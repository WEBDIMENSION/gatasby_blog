{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/Environment/Docker/docker_dns_http-proxy/","result":{"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"fd8999ce-2010-59b4-8f8a-76755f2a45f5","excerpt":"hostsファイルを書き換えずに localhost に向ける 開発条件によってはhostsファイルを書き換えて開発しなければいけないことがある。 hostsファイルを書き換えるデメリット PCすべてが  local, remote…","html":"<h2>hostsファイルを書き換えずに localhost に向ける</h2>\n<p>開発条件によってはhostsファイルを書き換えて開発しなければいけないことがある。</p>\n<h3>hostsファイルを書き換えるデメリット</h3>\n<ul>\n<li>PCすべてが <code class=\"language-text\">hostsファイルの影響を受ける</code></li>\n<li>local, remote と向き先を切り替えるのに毎回 <code class=\"language-text\">hosts</code> を書き換えるのはめんどくさい</li>\n<li>上記からミスも発生する可能性あり。(localを見ているつもりがremoteをみていた)</li>\n</ul>\n<h3>nginx-proxy coredns http-proxy(apache) nginx で環境を構築</h3>\n<ul>\n<li>開発用のブラウザを用意して dns 設定を <code class=\"language-text\">nginx-proxy</code> のリバースプロキシで443 を corednsへ向ける <a href=\"https://localhost/dns-query\">https://localhost/dns-query</a></li>\n<li>IntellijIdeaなどの httpクライアントで http-proxy を設定することにより localhost へ向ける localhost:8888</li>\n</ul>\n<p><em><strong>http-proxy を通した場合は proxyサーバーの DNSが優先される。<code class=\"language-text\">/etc/resole.conf</code> で <code class=\"language-text\">coredns</code> を参照させる。</strong></em></p>\n<h4>docker-compose.yml</h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">coredns</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./coredns\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_coredns\n    <span class=\"token comment\">#    profiles: [\"debug\"]</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> on<span class=\"token punctuation\">-</span>failure\n    <span class=\"token key atrule\">expose</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'53'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'53/udp'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'443'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'443/udp'</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./coredns/config<span class=\"token punctuation\">:</span>/etc/coredns\n      <span class=\"token punctuation\">-</span> ./certs<span class=\"token punctuation\">:</span>/certs\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"53:53\"</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"53:53/udp\"</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 172.30.0.100\n\n  <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./nginx<span class=\"token punctuation\">-</span>proxy\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_$<span class=\"token punctuation\">{</span>PROXY_CONTAINER_NAME<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>HOST_HTTP_PORT<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>CONTAINER_HTTP_PORT<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>HOST_HTTPS_PORT<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>CONTAINER_HTTPS_PORT<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./nginx<span class=\"token punctuation\">-</span>proxy/conf.d/timeout.conf<span class=\"token punctuation\">:</span>/etc/nginx/conf.d/timeout.conf\n      <span class=\"token punctuation\">-</span> ./nginx<span class=\"token punctuation\">-</span>proxy/conf.d/dns.conf<span class=\"token punctuation\">:</span>/etc/nginx/conf.d/dns.conf\n      <span class=\"token punctuation\">-</span> ./nginx<span class=\"token punctuation\">-</span>proxy/conf.d/dns<span class=\"token punctuation\">-</span>test.conf<span class=\"token punctuation\">:</span>/etc/nginx/conf.d/dns<span class=\"token punctuation\">-</span>test.conf\n      <span class=\"token punctuation\">-</span> ./nginx<span class=\"token punctuation\">-</span>proxy/html/nginx<span class=\"token punctuation\">-</span>proxy.html<span class=\"token punctuation\">:</span>/usr/share/nginx/html/nginx<span class=\"token punctuation\">-</span>proxy.html\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/tmp/docker.sock<span class=\"token punctuation\">:</span>ro\n      <span class=\"token punctuation\">-</span> ./certs<span class=\"token punctuation\">:</span>/etc/nginx/certs<span class=\"token punctuation\">:</span>ro\n    <span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">options</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">max-size</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5m\"</span>\n        <span class=\"token key atrule\">max-file</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"10\"</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 172.30.0.2\n\n  <span class=\"token key atrule\">httpd_proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_httpd_proxy\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>PWD<span class=\"token punctuation\">}</span>/httpd_proxy\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8888:8888\"</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>PWD<span class=\"token punctuation\">}</span>/httpd_proxy/conf.d/httpd.conf<span class=\"token punctuation\">:</span>/usr/local/apache2/conf/httpd.conf\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>PWD<span class=\"token punctuation\">}</span>/httpd_proxy/conf.d/proxy<span class=\"token punctuation\">-</span>html.conf<span class=\"token punctuation\">:</span>/usr/local/apache2/conf/extra/proxy<span class=\"token punctuation\">-</span>html.conf\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>PWD<span class=\"token punctuation\">}</span>/httpd_proxy/resolv.conf<span class=\"token punctuation\">:</span>/etc/resolv.conf\n    <span class=\"token key atrule\">extra_hosts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"host.docker.internal:host-gateway\"</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 172.30.0.110\n\n  <span class=\"token key atrule\">nginx</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./nginx\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_$<span class=\"token punctuation\">{</span>NGINX_CONTAINER_NAME<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VIRTUAL_HOST</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>HOSTNAME<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">CERT_NAME</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>CERTS_FILE_NAME<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">HTTPS_METHOD</span><span class=\"token punctuation\">:</span> noredirect\n    <span class=\"token key atrule\">env_file</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> .env\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>PWD<span class=\"token punctuation\">}</span>/react/app/build<span class=\"token punctuation\">:</span>/usr/share/nginx/html\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>PWD<span class=\"token punctuation\">}</span>/$<span class=\"token punctuation\">{</span>NGINX_CONF_DIR<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>/etc/nginx/conf.d<span class=\"token punctuation\">:</span>rw\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> /bin/sh <span class=\"token punctuation\">-</span>c \"DOLLAR=$ envsubst &lt; /etc/nginx/conf.d/default.conf.tpl <span class=\"token punctuation\">></span> /etc/nginx/conf.d/default.conf <span class=\"token important\">&amp;&amp;</span> nginx <span class=\"token punctuation\">-</span>g 'daemon off;'\"\n    <span class=\"token key atrule\">working_dir</span><span class=\"token punctuation\">:</span> /usr/share/nginx/html\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 172.30.0.3\n\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">node_volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx_proxy_node_volumes\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">keep</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> bridge\n    <span class=\"token key atrule\">ipam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> default\n      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">subnet</span><span class=\"token punctuation\">:</span> 172.30.0.0/24\n          <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span> 172.30.0.1\n    <span class=\"token key atrule\">external</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n</code></pre></div>\n<p>それぞれのコンテナのIP固定化</p>\n<h4>coredns DoH (dns over https) 対応</h4>\n<p><code class=\"language-text\">corefile</code></p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">https://.:443 {\n    tls /certs/server.crt /certs/server.key\n    hosts /etc/coredns/hosts_doh {\n      fallthrough\n    }\n    forward . 8.8.4.4 8.8.8.8\n    log\n    cache 30\n}\n\n. {\n  hosts /etc/coredns/hosts_proxy {\n    fallthrough\n  }\n  forward . 8.8.4.4 8.8.8.8\n  log\n  cache 30\n}</code></pre></div>\n<p><code class=\"language-text\">hosts_doh</code></p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">127.0.0.1 www.yahoo.co.jp</code></pre></div>\n<p><code class=\"language-text\">hosts_proxy</code></p>\n<p>172.30.0.3 <a href=\"http://www.yahoo.co.jp\">www.yahoo.co.jp</a></p>\n<h3>nginx-proxy</h3>\n<p>/etc/nginx/conf.d/dns-conf</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">server <span class=\"token punctuation\">{</span>\n    listen              <span class=\"token number\">80</span>                 <span class=\"token punctuation\">;</span>\n    listen       <span class=\"token number\">443</span> ssl <span class=\"token punctuation\">;</span>\n    listen       <span class=\"token punctuation\">[</span>::<span class=\"token punctuation\">]</span>:443 ssl <span class=\"token punctuation\">;</span>\n    server_name      localhost<span class=\"token punctuation\">;</span>\n    ssl_certificate     /etc/nginx/certs/server.crt<span class=\"token punctuation\">;</span>\n    ssl_certificate_key /etc/nginx/certs/server.key<span class=\"token punctuation\">;</span>\n\n    access_log /var/log/nginx/access.log<span class=\"token punctuation\">;</span>\n    error_log  /var/log/nginx/error.log<span class=\"token punctuation\">;</span>\n\n    location /dns-query <span class=\"token punctuation\">{</span>\n        proxy_buffers <span class=\"token number\">8</span> 32K<span class=\"token punctuation\">;</span> <span class=\"token comment\"># default 8 4k|8k</span>\n        proxy_buffer_size 32k<span class=\"token punctuation\">;</span> <span class=\"token comment\"># default 4k|8k</span>\n        proxy_busy_buffers_size 64k<span class=\"token punctuation\">;</span> <span class=\"token comment\"># default 8k|16k</span>\n        proxy_request_buffering off<span class=\"token punctuation\">;</span>\n        proxy_buffering off<span class=\"token punctuation\">;</span>\n        proxy_redirect off<span class=\"token punctuation\">;</span>\n        proxy_http_version <span class=\"token number\">1.1</span><span class=\"token punctuation\">;</span>\n        proxy_set_header Host <span class=\"token variable\">$http_host</span><span class=\"token punctuation\">;</span>\n        proxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n        proxy_set_header X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span><span class=\"token punctuation\">;</span>\n        proxy_pass https://coredns:443<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n   location / <span class=\"token punctuation\">{</span>\n      root  /usr/share/nginx/html<span class=\"token punctuation\">;</span>\n      index nginx-proxy.html<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em><strong><code class=\"language-text\">localhost/dns-query</code> で doh を実現</strong></em></p>\n<h4>http-proxy</h4>\n<p><code class=\"language-text\">httpd.conf</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ServerRoot <span class=\"token string\">\"/usr/local/apache2\"</span>\n\nListen <span class=\"token number\">80</span>\nLoadModule mpm_event_module modules/mod_mpm_event.so\nLoadModule authn_file_module modules/mod_authn_file.so\nLoadModule authn_core_module modules/mod_authn_core.so\nLoadModule authz_host_module modules/mod_authz_host.so\nLoadModule authz_groupfile_module modules/mod_authz_groupfile.so\nLoadModule authz_user_module modules/mod_authz_user.so\nLoadModule authz_core_module modules/mod_authz_core.so\nLoadModule access_compat_module modules/mod_access_compat.so\nLoadModule auth_basic_module modules/mod_auth_basic.so\nLoadModule reqtimeout_module modules/mod_reqtimeout.so\nLoadModule filter_module modules/mod_filter.so\nLoadModule proxy_html_module modules/mod_proxy_html.so\nLoadModule mime_module modules/mod_mime.so\nLoadModule log_config_module modules/mod_log_config.so\nLoadModule env_module modules/mod_env.so\nLoadModule headers_module modules/mod_headers.so\nLoadModule setenvif_module modules/mod_setenvif.so\nLoadModule version_module modules/mod_version.so\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_connect_module modules/mod_proxy_connect.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule unixd_module modules/mod_unixd.so\nLoadModule status_module modules/mod_status.so\nLoadModule autoindex_module modules/mod_autoindex.so\n<span class=\"token operator\">&lt;</span>IfModule <span class=\"token operator\">!</span>mpm_prefork_module<span class=\"token operator\">></span>\n\t<span class=\"token comment\">#LoadModule cgid_module modules/mod_cgid.so</span>\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>IfModule mpm_prefork_module<span class=\"token operator\">></span>\n\t<span class=\"token comment\">#LoadModule cgi_module modules/mod_cgi.so</span>\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\nLoadModule dir_module modules/mod_dir.so\nLoadModule alias_module modules/mod_alias.so\n\n<span class=\"token operator\">&lt;</span>IfModule unixd_module<span class=\"token operator\">></span>\nUser www-data\nGroup www-data\n\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\nServerAdmin you@example.com\n<span class=\"token operator\">&lt;</span>Directory /<span class=\"token operator\">></span>\n    AllowOverride none\n    Require all denied\n<span class=\"token operator\">&lt;</span>/Directory<span class=\"token operator\">></span>\nDocumentRoot <span class=\"token string\">\"/usr/local/apache2/htdocs\"</span>\n<span class=\"token operator\">&lt;</span>Directory <span class=\"token string\">\"/usr/local/apache2/htdocs\"</span><span class=\"token operator\">></span>\n    Options Indexes FollowSymLinks\n    AllowOverride None\n    Require all granted\n<span class=\"token operator\">&lt;</span>/Directory<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>IfModule dir_module<span class=\"token operator\">></span>\n    DirectoryIndex index.html\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>Files <span class=\"token string\">\".ht*\"</span><span class=\"token operator\">></span>\n    Require all denied\n<span class=\"token operator\">&lt;</span>/Files<span class=\"token operator\">></span>\nErrorLog /proc/self/fd/2\nLogLevel warn\n\n<span class=\"token operator\">&lt;</span>IfModule log_config_module<span class=\"token operator\">></span>\n    LogFormat <span class=\"token string\">\"%h %l %u %t <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%r<span class=\"token entity\" title=\"\\&quot;\">\\\"</span> %>s %b <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%{Referer}i<span class=\"token entity\" title=\"\\&quot;\">\\\"</span> <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%{User-Agent}i<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>\"</span> combined\n    LogFormat <span class=\"token string\">\"%h %l %u %t <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%r<span class=\"token entity\" title=\"\\&quot;\">\\\"</span> %>s %b\"</span> common\n\n    <span class=\"token operator\">&lt;</span>IfModule logio_module<span class=\"token operator\">></span>\n      LogFormat <span class=\"token string\">\"%h %l %u %t <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%r<span class=\"token entity\" title=\"\\&quot;\">\\\"</span> %>s %b <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%{Referer}i<span class=\"token entity\" title=\"\\&quot;\">\\\"</span> <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>%{User-Agent}i<span class=\"token entity\" title=\"\\&quot;\">\\\"</span> %I %O\"</span> combinedio\n    <span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n    CustomLog /proc/self/fd/1 common\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>IfModule alias_module<span class=\"token operator\">></span>\n    ScriptAlias /cgi-bin/ <span class=\"token string\">\"/usr/local/apache2/cgi-bin/\"</span>\n\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>IfModule cgid_module<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>Directory <span class=\"token string\">\"/usr/local/apache2/cgi-bin\"</span><span class=\"token operator\">></span>\n    AllowOverride None\n    Options None\n    Require all granted\n<span class=\"token operator\">&lt;</span>/Directory<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>IfModule headers_module<span class=\"token operator\">></span>\n    <span class=\"token comment\">#</span>\n    <span class=\"token comment\"># Avoid passing HTTP_PROXY environment to CGI's on this or any proxied</span>\n    <span class=\"token comment\"># backend servers which have lingering \"httpoxy\" defects.</span>\n    <span class=\"token comment\"># 'Proxy' request header is undefined by the IETF, not listed by IANA</span>\n    <span class=\"token comment\">#</span>\n    RequestHeader <span class=\"token builtin class-name\">unset</span> Proxy early\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>IfModule mime_module<span class=\"token operator\">></span>\n    TypesConfig conf/mime.types\n    AddType application/x-compress .Z\n    AddType application/x-gzip .gz .tgz\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>IfModule proxy_html_module<span class=\"token operator\">></span>\nInclude conf/extra/proxy-html.conf\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>IfModule ssl_module<span class=\"token operator\">></span>\nSSLRandomSeed startup <span class=\"token builtin class-name\">builtin</span>\nSSLRandomSeed connect <span class=\"token builtin class-name\">builtin</span>\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span></code></pre></div>\n<p><code class=\"language-text\">/etc/nginx/conf.d/http_proxy.conf</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ProxyHTMLLinks\ta\t\thref\nProxyHTMLLinks\tarea\t\thref\nProxyHTMLLinks\t<span class=\"token function\">link</span>\t\thref\nProxyHTMLLinks\timg\t\tsrc longdesc usemap\nProxyHTMLLinks\tobject\t\tclassid codebase data usemap\nProxyHTMLLinks\tq\t\tcite\nProxyHTMLLinks\tblockquote\tcite\nProxyHTMLLinks\tins\t\tcite\nProxyHTMLLinks\tdel\t\tcite\nProxyHTMLLinks\tform\t\taction\nProxyHTMLLinks\tinput\t\tsrc usemap\nProxyHTMLLinks\t<span class=\"token function\">head</span>\t\tprofile\nProxyHTMLLinks\tbase\t\thref\nProxyHTMLLinks\tscript\t\tsrc <span class=\"token keyword\">for</span>\n\n<span class=\"token comment\"># To support scripting events (with ProxyHTMLExtended On),</span>\n<span class=\"token comment\"># you'll need to declare them too.</span>\n\nProxyHTMLEvents\tonclick ondblclick onmousedown onmouseup <span class=\"token punctuation\">\\</span>\n\t\tonmouseover onmousemove onmouseout onkeypress <span class=\"token punctuation\">\\</span>\n\t\tonkeydown onkeyup onfocus onblur onload <span class=\"token punctuation\">\\</span>\n\t\tonunload onsubmit onreset onselect onchange\n\n<span class=\"token operator\">&lt;</span>IfModule mod_proxy.c<span class=\"token operator\">></span>\n    ProxyRequests On\n    ProxyVia On\n    Listen <span class=\"token number\">8888</span>\n    <span class=\"token operator\">&lt;</span>Proxy *<span class=\"token operator\">></span>\n        Order deny,allow\n        Deny from all\n        Allow from all\n    <span class=\"token operator\">&lt;</span>/Proxy<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/IfModule<span class=\"token operator\">></span>\n</code></pre></div>\n<p><code class=\"language-text\">/etc/resolve.conf</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nameserver <span class=\"token number\">172.30</span>.0.100\noptions ndots:0</code></pre></div>","frontmatter":{"title":"docker dns http-proxy","date":"September 18, 2023","post_modified":"September 18, 2023","description":"hostsファイルを書き換えずに localhost に向ける","tags":["Docker","開発環境"],"draft":false}},"previous":{"fields":{"slug":"/BackEnd/php/phpunit/"},"frontmatter":{"title":"PHPUnit 備忘録"}},"next":null},"pageContext":{"id":"fd8999ce-2010-59b4-8f8a-76755f2a45f5","previousPostId":"54b5b85a-eaac-51ff-9fe6-797807ae9e12","nextPostId":null,"draft":false}},"staticQueryHashes":["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575","3679674316"]}
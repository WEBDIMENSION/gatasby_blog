{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/BackEnd/php/laravel/laravel_docker/",
    "result": {"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"0e8a8b35-7f60-5bdf-94a3-bc8503f57519","excerpt":"Laravel を動かす Docker 環境(Docker-compose) docker-compose.yml .env Require <Your xxx> Dockerfile nginx default.conf","html":"<h1>Laravel を動かす Docker 環境(Docker-compose)</h1>\n<h2>docker-compose.yml</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">php</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/php\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_php\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/../Laravel<span class=\"token punctuation\">:</span>/var/www/html\n      <span class=\"token punctuation\">-</span> .$<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/php/php.ini<span class=\"token punctuation\">:</span>/usr/local/etc/php/php.ini\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/php/conf.d/xdebug.ini<span class=\"token punctuation\">:</span>/usr/local/etc/php/conf.d/xdebug.ini\n    <span class=\"token key atrule\">external_links</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> smtp\n    <span class=\"token comment\">#      - mysql5.7:mysql5.7</span>\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> mysql\n    <span class=\"token key atrule\">links</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> mysql<span class=\"token punctuation\">:</span>mysql\n  <span class=\"token key atrule\">nginx</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_nginx\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> VIRTUAL_HOST=$<span class=\"token punctuation\">{</span>VIRTUAL_HOST<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> CERT_NAME=server\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/php/logs<span class=\"token punctuation\">:</span>/var/logs/nginx\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/../Laravel<span class=\"token punctuation\">:</span>/var/www/html\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/nginx/conf.d/default.conf<span class=\"token punctuation\">:</span>/etc/nginx/conf.d/default.conf\n    <span class=\"token key atrule\">links</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> php<span class=\"token punctuation\">:</span>php\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> php\n  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.7</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_mysql5_7\n    <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1000:50\"</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/mysql/my.cnf<span class=\"token punctuation\">:</span>/etc/mysql/my.cnf\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/mysql/data<span class=\"token punctuation\">:</span>/var/lib/mysql\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/mysql/init<span class=\"token punctuation\">:</span>/docker<span class=\"token punctuation\">-</span>entrypoint<span class=\"token punctuation\">-</span>initdb.d\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/mysql/logs<span class=\"token punctuation\">:</span>/var/log/mysql\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">MYSQL_DATABASE</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>DB_DATABASE<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">MYSQL_USER</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>DB_USERNAME<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">MYSQL_PASSWORD</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>DB_PASSWORD<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>DB_ROOT_PASSWORD<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DB_PORT<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span><span class=\"token number\">3306</span>\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> mysqld <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>character<span class=\"token punctuation\">-</span>set<span class=\"token punctuation\">-</span>server=utf8 <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>collation<span class=\"token punctuation\">-</span>server=utf8_unicode_ci <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>innodb<span class=\"token punctuation\">-</span>buffer<span class=\"token punctuation\">-</span>pool<span class=\"token punctuation\">-</span>size=256M <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>innodb_use_native_aio=0\n  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_redis\n    <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"999:redis\"</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>REDIS_PORT<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span><span class=\"token number\">6379</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/redis/data<span class=\"token punctuation\">:</span>/data\n\n  <span class=\"token key atrule\">node</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">:</span><span class=\"token number\">10</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>COMPOSE_PROJECT_NAME<span class=\"token punctuation\">}</span>_node\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/../Laravel/node<span class=\"token punctuation\">:</span>/node\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>DIR_PATH<span class=\"token punctuation\">}</span>/node/certs<span class=\"token punctuation\">:</span>/certs\n    <span class=\"token key atrule\">working_dir</span><span class=\"token punctuation\">:</span> /node\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">CERTS_DIR_PATH</span><span class=\"token punctuation\">:</span> /certs/\n      <span class=\"token key atrule\">REDIS_HOST</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>REDIS_HOST<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">REDIS_PORT</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>REDIS_PORT<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">MIX_NODE_PORT</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>MIX_NODE_PORT<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> $<span class=\"token punctuation\">{</span>MIX_NODE_PORT<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> bash <span class=\"token punctuation\">-</span>c  \"npm install <span class=\"token important\">&amp;&amp;</span> npm start\"\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> mysql\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">external</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>proxy</code></pre></div>\n<h2>.env</h2>\n<p><em>Require</em> &#x3C;Your xxx></p>\n<div class=\"gatsby-highlight\" data-language=\"env\"><pre class=\"language-env\"><code class=\"language-env\">COMPOSE_PROJECT_NAME=&lt;Your project name&gt;\nDIR_PATH=&lt;Your Absolute path&gt; # /var/www/xxxxx\nAPP_NAME=Tournament\nAPP_ENV=local\nAPP_KEY=&lt;Your APP_KEY&gt;\nAPP_DEBUG=true\nVIRTUAL_HOST=&lt;Your host&gt; # example.local\nAPP_URL=https://&quot;${VIRTUAL_HOST}&quot;\n\nLOG_CHANNEL=stack\n\nDB_CONNECTION=mysql\nDB_HOST=mysql\nDB_PORT=3306\nDB_DATABASE=laravel\nDB_USERNAME=laravel\nDB_PASSWORD=laravel\nDB_ROOT_PASSWORD=root\n\nBROADCAST_DRIVER=log\nCACHE_DRIVER=redis\nQUEUE_CONNECTION=sync\nSESSION_DRIVER=database\nSESSION_LIFETIME=120\n\nREDIS_HOST=redis\nREDIS_PASSWORD=null\nREDIS_PORT=6379\n\nMAIL_DRIVER=smtp\nMAIL_HOST=smtp.mailtrap.io\nMAIL_PORT=2525\nMAIL_USERNAME=null\nMAIL_PASSWORD=null\nMAIL_ENCRYPTION=null\n\nAWS_ACCESS_KEY_ID=\nAWS_SECRET_ACCESS_KEY=\nAWS_DEFAULT_REGION=us-east-1\nAWS_BUCKET=\n\nPUSHER_APP_ID=\nPUSHER_APP_KEY=\nPUSHER_APP_SECRET=\nPUSHER_APP_CLUSTER=mt1\n\nMIX_PUSHER_APP_KEY=&quot;${PUSHER_APP_KEY}&quot;\nMIX_PUSHER_APP_CLUSTER=&quot;${PUSHER_APP_CLUSTER}&quot;\n\nDEV_FAKER_LOCALE=ja_JP\n\nMIX_NODE_HOST=&quot;${VIRTUAL_HOST}&quot;\nMIX_NODE_INTERNAL_HOST=node\nMIX_NODE_PORT=3000</code></pre></div>\n<h2>Dockerfile</h2>\n<div class=\"gatsby-highlight\" data-language=\"docer\"><pre class=\"language-docer\"><code class=\"language-docer\">FROM php:7.2.8-fpm\nRUN apt-get update &amp;&amp; apt-get install -y \\\n  libssl-dev \\\n  git \\\n  wget \\\n  unzip \\\n  vim\nRUN apt-get -y update\nRUN apt-get install -y \\\n    curl \\\n    gnupg\nRUN curl -sL https://deb.nodesource.com/setup_11.x | bash -\nRUN apt-get install -y nodejs\nRUN npm install npm@latest -g\n# PDO\nRUN docker-php-ext-install pdo_mysql\n# redis\nRUN docker-php-source extract\nRUN git clone -b 4.1.1 --depth 1 https://github.com/phpredis/phpredis.git /usr/src/php/ext/redis &amp;&amp; \\\n    docker-php-ext-install redis\n# xdebug\nRUN pecl install xdebug \\\n  &amp;&amp; docker-php-ext-enable xdebug\n# php-zip\nRUN apt-get install -y zlib1g-dev \\\n    &amp;&amp; docker-php-ext-install zip\n##Chrome Driver RUN apt-get install -y libnss3\n#RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -\n#RUN echo &quot;deb http://dl.googlttcom/linux/chrome/deb/ stable main&quot; &gt;&gt; /etc/apt/sources.list.d/google.list\n#RUN apt-get update &amp;&amp; apt-get install -y google-chrome-stable\n# GD\nRUN apt-get update &amp;&amp; apt-get install -y \\\n        libfreetype6-dev \\\n        libjpeg62-turbo-dev \\\n        libmcrypt-dev \\\n        libpng-dev \\\n    &amp;&amp; docker-php-ext-install -j$(nproc) iconv \\\n    &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n    &amp;&amp; docker-php-ext-install -j$(nproc) gd\n# install composer\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer</code></pre></div>\n<h2>nginx default.conf</h2>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">server {\n  listen      80;\n  server_name YOUR_HOSTNAME;  // maybe equals VIRTUAL_HOST in .env\n    root /var/www/html/public;\n  location / {\n    try_files $uri $uri/ /index.php$is_args$args;\n    index index.html index.php;\n  }\n  location ~ \\.php$ {\n    fastcgi_split_path_info ^(.+\\.php)(/.+)$;\n    fastcgi_pass php:9000;\n    fastcgi_index index.php;\n    include fastcgi_params;\n      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n      fastcgi_param PATH_INFO $fastcgi_path_info;\n  }\n}</code></pre></div>","frontmatter":{"title":"Laravel を動かすDocker環境(Docker-compose)","date":"December 15, 2020","post_modified":"December 15, 2020","description":"laravelを動かすDocker-compose の一例","tags":["PHP","Docker","Laravel"],"draft":false}},"previous":{"fields":{"slug":"/BackEnd/php/laravel/laravel_db_rule/"},"frontmatter":{"title":"Laravel DB　命名規則"}},"next":{"fields":{"slug":"/BackEnd/php/laravel/laravel_eloquent/"},"frontmatter":{"title":"Laravel Eloquent 備忘録"}}},"pageContext":{"id":"0e8a8b35-7f60-5bdf-94a3-bc8503f57519","previousPostId":"6cf30e93-b704-537a-9e55-32d65c428d98","nextPostId":"0f267c8a-6e5d-5b7b-9c77-debfd970e73b","draft":false}},
    "staticQueryHashes": ["1126706167","1176493165","1188992244","1314910092","2772418575"]}
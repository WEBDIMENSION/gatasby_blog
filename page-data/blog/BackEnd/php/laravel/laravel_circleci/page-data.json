{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/BackEnd/php/laravel/laravel_circleci/",
    "result": {"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"7a33a3cc-3759-5fd2-a745-7b6bff661b88","excerpt":"Laravel, CircleCI Circle-ci Laravel Make directory (project top) Create config.yml Circle-CI-CLI ( Exec circle-cli on local ) Install for Linux , Mac Ansible…","html":"<h1>Laravel, CircleCI</h1>\n<h2>Circle-ci Laravel</h2>\n<p>Make directory (project top)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> .circle-ci</code></pre></div>\n<p>Create config.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vim</span> config.yml</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/php<span class=\"token punctuation\">:</span>7.2<span class=\"token punctuation\">-</span>stretch<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span>browsers\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">APP_URL</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8000</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">APP_DEBUG</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">APP_ENV</span><span class=\"token punctuation\">:</span> testing\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">APP_KEY</span><span class=\"token punctuation\">:</span> &lt;APP_KEY<span class=\"token punctuation\">></span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">DEV_FAKER_LOCALE</span><span class=\"token punctuation\">:</span> ja_JP\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">DB_CONNECTION</span><span class=\"token punctuation\">:</span> circleci\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MIX_NODE_HOST</span><span class=\"token punctuation\">:</span> &lt;YOUR_HOSTNAME<span class=\"token punctuation\">></span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MIX_NODE_INTERNAL_HOST</span><span class=\"token punctuation\">:</span> localhost\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MIX_NODE_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">REDIS_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.7</span>\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MYSQL_DATABASE</span><span class=\"token punctuation\">:</span> laravel\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MYSQL_USER</span><span class=\"token punctuation\">:</span> laravel\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">MYSQL_PASSWORD</span><span class=\"token punctuation\">:</span> laravel\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">:</span><span class=\"token number\">10</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span>latest\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> selenium/hub<span class=\"token punctuation\">:</span>3.141.59<span class=\"token punctuation\">-</span>vanadium\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> selenium/node<span class=\"token punctuation\">-</span>chrome<span class=\"token punctuation\">:</span>3.141.59<span class=\"token punctuation\">-</span>vanadium\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">HUB_HOST</span><span class=\"token punctuation\">:</span> localhost\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">HUB_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4444</span>\n\n    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> ~/repo\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> chromedriver\n          <span class=\"token key atrule\">background</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n      <span class=\"token punctuation\">-</span> checkout\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> install dockerize\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> wget https<span class=\"token punctuation\">:</span>//github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize<span class=\"token punctuation\">-</span>linux<span class=\"token punctuation\">-</span>amd64<span class=\"token punctuation\">-</span>$DOCKERIZE_VERSION.tar.gz <span class=\"token important\">&amp;&amp;</span> sudo tar <span class=\"token punctuation\">-</span>C /usr/local/bin <span class=\"token punctuation\">-</span>xzvf dockerize<span class=\"token punctuation\">-</span>linux<span class=\"token punctuation\">-</span>amd64<span class=\"token punctuation\">-</span>$DOCKERIZE_VERSION.tar.gz <span class=\"token important\">&amp;&amp;</span> rm dockerize<span class=\"token punctuation\">-</span>linux<span class=\"token punctuation\">-</span>amd64<span class=\"token punctuation\">-</span>$DOCKERIZE_VERSION.tar.gz\n          <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">DOCKERIZE_VERSION</span><span class=\"token punctuation\">:</span> v0.6.1\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install PHP Extensions\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> sudo docker<span class=\"token punctuation\">-</span>php<span class=\"token punctuation\">-</span>ext<span class=\"token punctuation\">-</span>install pdo_mysql\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> v1<span class=\"token punctuation\">-</span>dependencies<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"Laravel/composer.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">-</span> v1<span class=\"token punctuation\">-</span>dependencies<span class=\"token punctuation\">-</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> v1<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"Laravel/node/package.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">-</span> v1<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> npm install\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel/node\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> npm install\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> start node server\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel/node\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> node ./bin/node_server.js\n          <span class=\"token key atrule\">background</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">CERTS_DIR_PATH</span><span class=\"token punctuation\">:</span> /home/circleci/repo/docker/node/certs/\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">REDIS_HOST</span><span class=\"token punctuation\">:</span> 0.0.0.0\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">REDIS_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> composer install\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> composer install <span class=\"token punctuation\">-</span>n <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>prefer<span class=\"token punctuation\">-</span>dist\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./Laravel/vendor\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">-</span>dependencies<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"Laravel/composer.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./Laravel/node/node_modules\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"Laravel/node/package.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Wait for db\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> dockerize <span class=\"token punctuation\">-</span>wait tcp<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306 <span class=\"token punctuation\">-</span>timeout 1m\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Migration &amp; Seeding\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> php artisan migrate <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>seed\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Artisan command\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> php artisan command<span class=\"token punctuation\">:</span>tournament 1\n\n      <span class=\"token comment\">#      - run:</span>\n      <span class=\"token comment\">#          name: Install Chrome Driver</span>\n      <span class=\"token comment\">#          working_directory: Laravel</span>\n      <span class=\"token comment\">#          command: php artisan dusk:chrome-driver</span>\n\n      <span class=\"token comment\">#      - run:</span>\n      <span class=\"token comment\">#          name: Start Chrome Driver</span>\n      <span class=\"token comment\">#          working_directory: Laravel</span>\n      <span class=\"token comment\">#          command: ./vendor/laravel/dusk/bin/chromedriver-linux</span>\n      <span class=\"token comment\">#          background: true</span>\n      <span class=\"token comment\">#</span>\n      <span class=\"token comment\">#      - run:</span>\n      <span class=\"token comment\">#          name: Start Chrome Driver</span>\n      <span class=\"token comment\">#          working_directory: Laravel</span>\n      <span class=\"token comment\">#          command: chmod 775 .vendor/laravel/dusk/bin/* &amp;&amp; ./vendor/laravel/dusk/bin/chromedriver-linux</span>\n      <span class=\"token comment\">#          background: true</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> phpcs\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ./vendor/bin/phpcs <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>standard=phpcs.xml ./\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run Laravel Server\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> php artisan serve\n          <span class=\"token key atrule\">background</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> phpunit\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ./vendor/bin/phpunit\n\n      <span class=\"token comment\">#      - run:</span>\n      <span class=\"token comment\">#          name:  Chrome version</span>\n      <span class=\"token comment\">#          working_directory: Laravel</span>\n      <span class=\"token comment\">#          command: google-chrome --version</span>\n      <span class=\"token comment\">#</span>\n      <span class=\"token comment\">#      - run:</span>\n      <span class=\"token comment\">#          name: Top</span>\n      <span class=\"token comment\">#          working_directory: Laravel</span>\n      <span class=\"token comment\">#          command: curl localhost:8000</span>\n      <span class=\"token comment\">#</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dusk\n          <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> Laravel\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> php artisan dusk</code></pre></div>\n<h3>Circle-CI-CLI ( Exec circle-cli on local )</h3>\n<p>Install for Linux , Mac</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -fLSs https://circle.ci/cli <span class=\"token operator\">|</span> <span class=\"token function\">bash</span></code></pre></div>\n<p>Ansible tasks</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># tasks file for circlci</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> check installed docker\n  <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> bash <span class=\"token punctuation\">-</span>lc \"circleci <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\"\n  <span class=\"token key atrule\">register</span><span class=\"token punctuation\">:</span> circleci_exists\n  <span class=\"token key atrule\">changed_when</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">False</span>\n  <span class=\"token key atrule\">ignore_errors</span><span class=\"token punctuation\">:</span> yes\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install circleci\n  <span class=\"token key atrule\">become</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">get_url</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://circle-downloads.s3.amazonaws.com/releases/build_agent_wrapper/circleci\"</span>\n    <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> /usr/local/bin/circleci\n    <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> +x\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> circleci_exists is failed</code></pre></div>\n<h3>Varidate</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">circleci config validate -c .circleci/config.yml</code></pre></div>\n<h3>Exec</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">circleci build .circleci/config.yml</code></pre></div>","frontmatter":{"title":"Laravel, CircleCI","date":"December 14, 2020","post_modified":"December 14, 2020","description":"laravelをCircleCIの備忘録","tags":["PHP","Laravel","CI/CD","Circle-CI"],"draft":false}},"previous":{"fields":{"slug":"/Infrastructure/Iac/ansible_vpn/"},"frontmatter":{"title":"VPNサーバー(SoftEhter)をAnsibleでConoha-VPNサーバーへ構築"}},"next":{"fields":{"slug":"/Infrastructure/Iac/ansible_letsencrypt/"},"frontmatter":{"title":"Ansible, Let's Encrypt"}}},"pageContext":{"id":"7a33a3cc-3759-5fd2-a745-7b6bff661b88","previousPostId":"74484b0f-9808-539f-9768-74a88d462e37","nextPostId":"89b7ec44-ccce-51ea-851b-05793c5a82c4","draft":false}},
    "staticQueryHashes": ["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575"]}
{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/BackEnd/DB/MySQL/ MySQL_Basic/","result":{"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"0f23e7ab-668a-5441-a833-dd00036eb439","excerpt":"Create table Create tmp table Drop primary key Drop NOT NULL Add primary key Mod primary key Dump optin mean description -u ユーザー名(user) サーバに接続するユーザー名 -p…","html":"<h2>Create table</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> dogs\n<span class=\"token punctuation\">(</span>\n    id       <span class=\"token keyword\">INT</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    name     <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    owner_id <span class=\"token keyword\">INT</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Create tmp table</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span>\n<span class=\"token keyword\">TEMPORARY</span> <span class=\"token keyword\">TABLE</span> tmp_t1 <span class=\"token punctuation\">(</span>\nid <span class=\"token keyword\">INT</span><span class=\"token punctuation\">,</span>\nname <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Drop primary key</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> テーブル名 <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Drop NOT NULL</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> test\n    <span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">COLUMN</span> a <span class=\"token keyword\">DROP</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Add primary key</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> tab1\n    <span class=\"token keyword\">ADD</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>emp_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> tab1\n    <span class=\"token keyword\">ADD</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>emp_id<span class=\"token punctuation\">,</span> emp_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Mod primary key</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> テーブル名 <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">ADD</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>カラム名<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Dump</h2>\n<table>\n<thead>\n<tr>\n<th>optin</th>\n<th>mean</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-u</td>\n<td>ユーザー名(user)</td>\n<td>サーバに接続するユーザー名</td>\n</tr>\n<tr>\n<td>-p</td>\n<td>パスワード(password)</td>\n<td>パスワードを指定してログイン</td>\n</tr>\n<tr>\n<td>-h</td>\n<td>ホスト名(host)</td>\n<td>接続するサーバのホスト名(ex. localhost, 127.0.0.1)指定しないと localhost になる</td>\n</tr>\n<tr>\n<td>-B</td>\n<td>データベース(dababase)</td>\n<td>複数のデータベースを名前を指定してダンプ</td>\n</tr>\n<tr>\n<td>-A</td>\n<td>すべてのデータベース(all)</td>\n<td>複数のデータベースをまとめてダンプ</td>\n</tr>\n<tr>\n<td>-d</td>\n<td>定義のみ(no-data)</td>\n<td>定義のみダンプを取りたいときに指定</td>\n</tr>\n<tr>\n<td>-n</td>\n<td>データベースは無視(no-create-db)</td>\n<td>データベースを作成せずにダンプ</td>\n</tr>\n<tr>\n<td>-t</td>\n<td>テーブルは無視(no-create-info)</td>\n<td>テーブルの作成を行わずにダンプ</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>option</th>\n<th>mean</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>—single-transaction</td>\n<td>ダンプを行う前に BEGIN ステートメントを発行する。内部的にスナップショットを取ってダンプを行うので、DB をロックせずに整合性の取れたダンプを取ることが可能</td>\n</tr>\n<tr>\n<td>—quick</td>\n<td>テーブルの全レコードをメモリにバッファせずに、1 行ずつダンプを行う。データ量の大きいテーブルのダンプ時にメモリを逼迫せずにダンプを行える。</td>\n</tr>\n<tr>\n<td>—opt</td>\n<td>—add-drop-table —add-locks —create-options —disable-keys —extended-insert —lock-tables —quick —set-charset の短縮形。</td>\n</tr>\n<tr>\n<td>—add-drop-table</td>\n<td>CREATE TABLE の前に DROP TABLE を含める</td>\n</tr>\n<tr>\n<td>—add-locks</td>\n<td>各テーブルの INSERT 前後に LOCK_TABLE 文と UNLOCK_TABLE 分を含めることで INSERT 速度が向上する</td>\n</tr>\n<tr>\n<td>—create-options</td>\n<td>MySQL に固有なテーブルオプションを CREATE TABLE に含める</td>\n</tr>\n<tr>\n<td>—disable-keys</td>\n<td>各テーブルで、全てのレコードのインポートが完了するまでインデックスを作らないようにする</td>\n</tr>\n<tr>\n<td>—extended-insert</td>\n<td>１つの INSERT 文で複数の VALUE を構文を利用する。これにより、ダンプで出力されるファイルサイズが減り、インポート時間も短縮される</td>\n</tr>\n<tr>\n<td>—lock-tables</td>\n<td>テーブルをダンプする前にロックする</td>\n</tr>\n<tr>\n<td>—set-charset</td>\n<td>SET NAMES default_character_set を出力に追加する</td>\n</tr>\n<tr>\n<td>—lock-all-tables</td>\n<td>データベース内のテーブル全てをロックする</td>\n</tr>\n<tr>\n<td>—master-data</td>\n<td>バイナリログファイルの名前と場所を出力に含める。—single-transaction が指定されてない場合は、—lock-all-tables が有効になる。</td>\n</tr>\n<tr>\n<td>—ignore-table=[DB 名].[テーブル名]</td>\n<td>指定されたテーブルをダンプしない</td>\n</tr>\n</tbody>\n</table>\n<h3>定義とデータのダンプ</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">--  database</span>\nmysqldump <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME <span class=\"token operator\">></span> OUTPUT_FILE_NAME\n<span class=\"token comment\">-- table</span>\nmysqldump <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME TABLE_NAME <span class=\"token operator\">></span> OUTPUT_FILE_NAM\n<span class=\"token comment\">-- テーブルの定義とデータのダンプ</span>\nmysqldump <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME <span class=\"token operator\">-</span>A <span class=\"token operator\">-</span>n <span class=\"token operator\">></span> OUTPUT_FILE_NAME</code></pre></div>\n<h3>全てのデータベース・テーブルのダンプ(定義とデータ)</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">--　データベース</span>\nmysqldump\n<span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME <span class=\"token operator\">-</span>A <span class=\"token operator\">></span> OUTPUT_FILE_NAME\n<span class=\"token comment\">-- テーブル（データベースを１つ選んでダンプ）</span>\nmysqldump <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME <span class=\"token operator\">></span> OUTPUT_FILE_NAME</code></pre></div>\n<h3>定義のみダンプ</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- データベースとテーブル定義をダンプ</span>\nmysqldump\n<span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME <span class=\"token operator\">-</span>d <span class=\"token operator\">></span> OUTPUT_FILE_NAME\n<span class=\"token comment\">-- データベースの定義のみダンプ</span>\nmysqldump <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>t <span class=\"token operator\">></span> OUTPUT_FILE_NAME\n<span class=\"token comment\">-- テーブルの定義のみダンプ</span>\nmysqldump <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>n <span class=\"token operator\">></span> OUTPUT_FILE_NAME</code></pre></div>\n<h3>Restore</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 出力されたスクリプトファイルの実行</span>\nmysql <span class=\"token operator\">-</span>u USER_NAME <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>h HOST_NAME DB_NAME <span class=\"token operator\">&lt;</span> OUTPUT_FILE_NAM</code></pre></div>\n<h2>基本コマンド</h2>\n<h3>ユーザ一覧を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>データベース一覧を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">show</span>\n<span class=\"token keyword\">databases</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>接続中のデータベースの情報を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> INFORMATION_SCHEMA<span class=\"token punctuation\">.</span>SCHEMATA\n<span class=\"token keyword\">where</span> SCHEMA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;table_name>'</span></code></pre></div>\n<h3>テーブル一覧を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">show</span>\n<span class=\"token keyword\">tables</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>テーブル定義を確認</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token operator\">&lt;</span>tabe_name<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>データディレクトリ確認</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">select</span> @@datadir<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>CSV 形式のファイルをテーブルに挿入</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">LOAD DATA LOCAL INFILE <span class=\"token string\">\"ファイル名\"</span>\nINTO TABLE テーブル名\nFIELDS TERMINATED BY <span class=\"token string\">'区切り文字'</span>\nOPTIONALLY ENCLOSED BY <span class=\"token string\">'囲み文字'</span><span class=\"token punctuation\">;</span>\n\nload data <span class=\"token builtin class-name\">local</span> infile <span class=\"token string\">\"&lt;file_path> \"</span> into table <span class=\"token operator\">&lt;</span>table_name<span class=\"token operator\">></span> fields terminated by <span class=\"token string\">','</span> optionally enclosed by <span class=\"token string\">'\"'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>CSV 形式のファイルをエクスポート</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">SELECT フィールド名 FROM テーブル名 INTO OUTFILE’出力したいファイル名’ FIELDS TERMINATED BY <span class=\"token string\">'区切り文字'</span> OPTIONALLY ENCLOSED BY <span class=\"token string\">'囲み文字'</span><span class=\"token punctuation\">;</span>\n\nSELECT * FROM <span class=\"token operator\">&lt;</span>table_name<span class=\"token operator\">></span>\nINTO OUTFILE <span class=\"token string\">'&lt;file_path>'</span>\nFIELDS TERMINATED BY <span class=\"token string\">','</span>\nOPTIONALLY ENCLOSED BY <span class=\"token string\">'\"'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>ファイルからコマンドを実行</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># SHellから</span>\nmysql -uroot -p <span class=\"token operator\">&lt;</span> create_user.dd\n<span class=\"token comment\">#  login後</span>\n<span class=\"token builtin class-name\">source</span> createDB.ddl</code></pre></div>\n<h3>インデックスリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">show index from <span class=\"token operator\">&lt;</span>table_name<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>パーティショニング</h2>\n<h3>RANGE パーティショニング</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> t1\n<span class=\"token punctuation\">(</span>\n    id   <span class=\"token keyword\">int</span>  <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    days <span class=\"token keyword\">DATE</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> RANGE <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">PARTITION</span> p0 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PARTITION</span> p1 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PARTITION</span> p2 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PARTITION</span> p3 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>LIST パーティショニング</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> t2\n<span class=\"token punctuation\">(</span>\n    id   <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    days <span class=\"token keyword\">date</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span>\n    <span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> LIST<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">PARTITION</span> p1 <span class=\"token keyword\">VALUES</span> <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PARTITION</span> p2 <span class=\"token keyword\">VALUES</span> <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PARTITION</span> p3 <span class=\"token keyword\">VALUES</span> <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PARTITION</span> p4 <span class=\"token keyword\">VALUES</span> <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>HASH パーティショニング</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> t3\n<span class=\"token punctuation\">(</span>\n    id   <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    days <span class=\"token keyword\">date</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span>\n    <span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">HASH</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n    PARTITIONS <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>KEY パーティショニング</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> t4\n<span class=\"token punctuation\">(</span>\n    id   <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n    days <span class=\"token keyword\">date</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span>\n    <span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    PARTITIONS <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">;</span></code></pre></div>\n<h4>example</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t1<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span>   <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>days<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">date</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span>\n    <span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> RANGE <span class=\"token punctuation\">(</span><span class=\"token keyword\">year</span><span class=\"token punctuation\">(</span>days<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">PARTITION</span> p0 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">1900</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span><span class=\"token punctuation\">,</span>\n <span class=\"token keyword\">PARTITION</span> p1 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">1950</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span><span class=\"token punctuation\">,</span>\n <span class=\"token keyword\">PARTITION</span> p2 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span><span class=\"token punctuation\">,</span>\n <span class=\"token keyword\">PARTITION</span> p3 <span class=\"token keyword\">VALUES</span> LESS THAN <span class=\"token punctuation\">(</span><span class=\"token number\">2050</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span></code></pre></div>\n<h4>設定の確認</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> TABLE_SCHEMA<span class=\"token punctuation\">,</span> TABLE_NAME<span class=\"token punctuation\">,</span> PARTITION_NAME<span class=\"token punctuation\">,</span> PARTITION_ORDINAL_POSITION<span class=\"token punctuation\">,</span> TABLE_ROWS\n<span class=\"token keyword\">FROM</span> INFORMATION_SCHEMA<span class=\"token punctuation\">.</span>PARTITIONS\n<span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;table_name>'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>パーティションの削除</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">table</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">></span> <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">PARTITION</span> <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">partition</span> name <span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>パーティションを戻す</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> <span class=\"token operator\">&lt;</span> table_name <span class=\"token operator\">></span> REMOVE PARTITIONING<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>パーティション追加</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> <span class=\"token operator\">&lt;</span> table_name <span class=\"token operator\">></span> <span class=\"token keyword\">ADD</span> <span class=\"token keyword\">PARTITION</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">PARTITION</span> p202201 <span class=\"token keyword\">VALUES</span> LESS THAN TO_DAYS<span class=\"token punctuation\">(</span><span class=\"token string\">'2022/02/01 00:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>外部キー</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>usersId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> users<span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>innodb であること</li>\n<li>primary-key であること</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">--  Options</span>\n<span class=\"token punctuation\">[</span><span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span>\nreference_option<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span><span class=\"token keyword\">ON</span>\n<span class=\"token keyword\">UPDATE</span> reference_option<span class=\"token punctuation\">]</span></code></pre></div>\n<h4>reference_option</h4>\n<p>RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT</p>\n<ul>\n<li>\n<p>RESTRICT<br>\n親テーブルに対して削除または更新を行うとエラーとなります。設定を省略した場合は RESTRICT を設定したのと同じです。</p>\n</li>\n<li>\n<p>CASCADE<br>\n親テーブルに対して削除または更新を行うと、子テーブルで同じ値を持つカラムのデータに対して削除または更新を行います。</p>\n</li>\n<li>\n<p>SET NULL<br>\n親テーブルに対して削除または更新を行うと、子テーブルの同じ値を持つカラムの値が NULL になります。</p>\n</li>\n<li>\n<p>NO ACTION<br>\n親テーブルに対して削除または更新を行うとエラーとなります。 RESTRICT を設定した場合と同じです。</p>\n</li>\n<li>\n<p>SET DEFAULT<br>\n現在この設定を行うとテーブルの作成が行えません。</p>\n</li>\n</ul>\n<h3>Command line Login</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">MYCNF</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">$(</span>dirname $0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/my.cnf\n<span class=\"token comment\"># function for create tmp my.cnf</span>\n<span class=\"token function-name function\">MYCNFCREATE</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">_EOL_<span class=\"token bash punctuation\"> <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> <span class=\"token variable\">${MYCNF}</span> <span class=\"token operator\">></span>/dev/null</span>\n[client]\nuser=<span class=\"token variable\">${MYSQL_USER}</span>\npassword=<span class=\"token variable\">${MYSQL_PASSWORD}</span>\n_EOL_</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\"># my.confがあれば削除してtmp my.cnf 作成</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> -f <span class=\"token variable\">${MYCNF}</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">then</span>\n MYCNFCREATE\n<span class=\"token keyword\">else</span>\n <span class=\"token function\">rm</span> -rf <span class=\"token variable\">${MYCNF}</span>\n MYCNFCREATE\n<span class=\"token keyword\">fi</span>\nmysql --defaults-extra-file<span class=\"token operator\">=</span><span class=\"token variable\">$MYCNF</span> -D <span class=\"token variable\">${MYSQL_DATABASE}</span> <span class=\"token operator\">&lt;</span> <span class=\"token variable\">${MYSQL_SYNC_LOCAL_SAVE_PATH}</span>/<span class=\"token variable\">$1</span></code></pre></div>","frontmatter":{"title":"MySQL 基本コマンド","date":"February 22, 2022","post_modified":"February 22, 2022","description":"MySQL よく使うコマンド これ覚えとけばなんとかなるかな","tags":["Database","MySQL"],"draft":false}},"previous":{"fields":{"slug":"/BackEnd/DB/Transaction/"},"frontmatter":{"title":"Database Transaction"}},"next":{"fields":{"slug":"/BackEnd/DB/MySQL/my_ini/"},"frontmatter":{"title":"MySQL の設定ファイル my.ini の項目"}}},"pageContext":{"id":"0f23e7ab-668a-5441-a833-dd00036eb439","previousPostId":"3ab79d42-7cb1-5a5c-be5f-167e44eef412","nextPostId":"ae8cae24-3eb4-5102-89c0-16f04b3101e9","draft":false}},"staticQueryHashes":["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575","3679674316"]}
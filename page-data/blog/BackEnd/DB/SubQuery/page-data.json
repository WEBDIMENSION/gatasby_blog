{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/BackEnd/DB/SubQuery/",
    "result": {"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"172d6518-1f4d-599d-8e00-b902c36d2890","excerpt":"単一値 (スカラー) subQuery で update subQuery で select 複数値 (ベクター) where In where Any/Akl subQuery に NULL を含んでいると結果も NULL になる IS NOT NULL COALESCE 表 (マトリックス) subQuery…","html":"<h2>単一値 (スカラー)</h2>\n<h3>subQuery で update</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">update</span> 家計簿集計\n  <span class=\"token keyword\">set</span> 平均 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">select</span> <span class=\"token function\">AVG</span> <span class=\"token punctuation\">(</span>出金額<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">from</span> 家計簿アーカイブ\n\t\t<span class=\"token keyword\">where</span> 出金額 <span class=\"token operator\">></span> <span class=\"token number\">0</span>\n\t\t<span class=\"token operator\">and</span> 費目 <span class=\"token operator\">=</span> <span class=\"token string\">'食費'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">where</span> 費目 <span class=\"token operator\">=</span> <span class=\"token string\">'食費'</span></code></pre></div>\n<h3>subQuery で select</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> 日付<span class=\"token punctuation\">,</span> メモ<span class=\"token punctuation\">,</span> 出金額<span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> 合計 <span class=\"token keyword\">from</span> 家計簿集計\n\t  <span class=\"token keyword\">where</span> 費目 <span class=\"token operator\">=</span> <span class=\"token string\">'食費'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> 過去の合計額\n<span class=\"token keyword\">from</span> 家計簿アーカイブ\n<span class=\"token keyword\">where</span> 費目 <span class=\"token operator\">=</span> <span class=\"token string\">'食費'</span></code></pre></div>\n<h2>複数値 (ベクター)</h2>\n<h3>where In</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> 家計簿集計\n<span class=\"token keyword\">where</span> 費目 <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> Dictinct 費目 <span class=\"token keyword\">from</span> 家計簿<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>where Any/Akl</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> 家計簿\n<span class=\"token keyword\">where</span> 費目 <span class=\"token operator\">=</span> <span class=\"token string\">'食費'</span>\n  <span class=\"token operator\">AND</span> 出金額 <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">ANY</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> 出金額 <span class=\"token keyword\">FROM</span> 家計簿アーカイブ\n    \t\t\t<span class=\"token keyword\">WHERE</span> 費目 <span class=\"token operator\">=</span> <span class=\"token string\">'食費'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>subQuery に NULL を含んでいると結果も NULL になる</strong></p>\n<h4>IS NOT NULL</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> 家計簿アーカイブ\n <span class=\"token keyword\">WHERE</span> 費目 <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> 費目 <span class=\"token keyword\">FROM</span> 家計簿\n \t\t<span class=\"token keyword\">WHERE</span> 費目 <span class=\"token operator\">IS</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>COALESCE</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> 家計簿アーカイブ\n <span class=\"token keyword\">WHERE</span> 費目 <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">COALESCE</span><span class=\"token punctuation\">(</span> 費目<span class=\"token punctuation\">,</span> <span class=\"token string\">'不明'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> 家計簿<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>表 (マトリックス)</h2>\n<h3>subQuery で FROM</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>SUB<span class=\"token punctuation\">.</span>出金額<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> 出勤合計\n <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token keyword\">SELECT</span> 日付<span class=\"token punctuation\">,</span> 費目<span class=\"token punctuation\">,</span> 出金額\n\t  <span class=\"token keyword\">FROM</span> 家計簿\n\t <span class=\"token keyword\">UNION</span>\n\t<span class=\"token keyword\">SELECT</span> 日付<span class=\"token punctuation\">,</span> 費目<span class=\"token punctuation\">,</span> 出金額\n\t  <span class=\"token keyword\">FROM</span> 家計簿アーカイブ\n\t<span class=\"token keyword\">WHERE</span> 日付 <span class=\"token operator\">>=</span> <span class=\"token string\">'2018-01-01'</span>\n\t       <span class=\"token operator\">AND</span> 日付 <span class=\"token operator\">&lt;=</span> <span class=\"token string\">'2018-01-31'</span>\n <span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> SUB</code></pre></div>\n<h3>subQuery で INSERT</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> 家計簿集計 <span class=\"token punctuation\">(</span>費目<span class=\"token punctuation\">,</span> 合計<span class=\"token punctuation\">,</span> 平均<span class=\"token punctuation\">,</span> 回数<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">SELECT</span> 費目、<span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>出金額<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">AVG</span><span class=\"token punctuation\">(</span>出金額<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">FROM</span> 家計簿\n<span class=\"token keyword\">WHERE</span> 出金額 <span class=\"token operator\">></span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> 費目</code></pre></div>","frontmatter":{"title":"Database SubQuery","date":"February 22, 2022","post_modified":"February 22, 2022","description":"SubQueryの基本的パターン","tags":["Database","MySQL","Postgres"],"draft":false}},"previous":{"fields":{"slug":"/BackEnd/DB/Join/"},"frontmatter":{"title":"Database Table結合の基本"}},"next":{"fields":{"slug":"/BackEnd/DB/Transaction/"},"frontmatter":{"title":"Database Transaction"}}},"pageContext":{"id":"172d6518-1f4d-599d-8e00-b902c36d2890","previousPostId":"6c05289d-0d2a-5ed0-9960-68a5122e8661","nextPostId":"40288557-fd8f-5a6d-ac3f-c82cb0eba2bd","draft":false}},
    "staticQueryHashes": ["1126706167","1176493165","1188992244","1314910092","2772418575"]}
{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/BackEnd/DB/Postgres/Postgres_basic/",
    "result": {"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"7015b7f1-5e79-57cf-b054-4bfc287305d3","excerpt":"Create Role Create SCHEMA Create table Create tmp table Drop primary key Drop NOT NULL Add primary key…","html":"<h2>Create Role</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> ROLE name <span class=\"token punctuation\">[</span> <span class=\"token keyword\">WITH</span> <span class=\"token punctuation\">]</span> LOGIN PASSWORD <span class=\"token string\">'password'</span>\n<span class=\"token comment\">-- Example</span>\n<span class=\"token keyword\">create</span> role saru <span class=\"token keyword\">with</span> login password <span class=\"token string\">'monkey'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Create SCHEMA</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">SCHEMA</span> schema_name</code></pre></div>\n<h2>Create table</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> test\n<span class=\"token punctuation\">(</span>\n    a <span class=\"token keyword\">int</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n    b <span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span>\n    c <span class=\"token keyword\">int</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> test\n<span class=\"token punctuation\">(</span>\n    a <span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span>\n    b <span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span>\n    c <span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">constraint</span> pk_test <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>\n     a\n     <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Create tmp table</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TEMP</span> <span class=\"token keyword\">TABLE</span> temp_sample1 <span class=\"token punctuation\">(</span> i <span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Drop primary key</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> test\n    <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">CONSTRAINT</span> pk_test<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 主キーを作成するときに自分で名前を付けていなければ、テーブル名_pkeyでOK</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> test\n    <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">CONSTRAINT</span> test_pkey<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Drop NOT NULL</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> test <span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">COLUMN</span> a <span class=\"token keyword\">DROP</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Add primary key</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> test <span class=\"token keyword\">ADD</span> <span class=\"token keyword\">CONSTRAINT</span> test_pkey <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>メタコマンド</h2>\n<h3>ユーザ一覧を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\du</span></code></pre></div>\n<h3>データベース一覧を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\l</span></code></pre></div>\n<h3>接続中のデータベースの情報を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\conninfo</span></code></pre></div>\n<h3>テーブル一覧を表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\z</span></code></pre></div>\n<h3>テーブル定義を確認</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\d tablename</span></code></pre></div>\n<h3>カレントディレクトリ変更</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\cd directory</span></code></pre></div>\n<h3>CSV 形式のファイルをテーブルに挿入</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\copy tablename from filename DELIMITER AS ','</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\copy TABLE_NAME from 'CSV_FILE_NAME.csv' (format csv, header false, encoding utf8);</span></code></pre></div>\n<h3>ファイルからコマンドを実行</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\i filename.sql</span></code></pre></div>\n<h3>シェル上のコマンドを使いたい場合</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\! command</span></code></pre></div>\n<h3>ベントリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\dy</span></code></pre></div>\n<h3>関数リスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\df</span></code></pre></div>\n<h3>インデックスリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\di</span></code></pre></div>\n<h3>スキーマリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\dn</span></code></pre></div>\n<h3>全スキーマのテーブルをリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\dt *.*</span></code></pre></div>\n<h3>全データ型をリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\dT+</span></code></pre></div>\n<h3>viewをリスト表示</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\dv</span></code></pre></div>\n<h2>パーティショニング</h2>\n<p><em><strong>親テーブル</strong></em></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> zenkoku_chiho_kokyodantai_code <span class=\"token punctuation\">(</span>\n     dantai_code     <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">,</span>todofuken_kanji <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">,</span>shichoson_kanji <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">,</span>todofuken_kana  <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">,</span>shichoson_kana  <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">partition</span> <span class=\"token keyword\">by</span> list <span class=\"token punctuation\">(</span>todofuken_kanji<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>パティションテーブル作成</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> zenkoku_chiho_kokyodantai_code_1  <span class=\"token keyword\">partition</span> <span class=\"token keyword\">of</span> zenkoku_chiho_kokyodantai_code <span class=\"token keyword\">for</span> <span class=\"token keyword\">values</span> <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'北海道'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> zenkoku_chiho_kokyodantai_code_2  <span class=\"token keyword\">partition</span> <span class=\"token keyword\">of</span> zenkoku_chiho_kokyodantai_code <span class=\"token keyword\">for</span> <span class=\"token keyword\">values</span> <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'青森県'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> zenkoku_chiho_kokyodantai_code_3  <span class=\"token keyword\">partition</span> <span class=\"token keyword\">of</span> zenkoku_chiho_kokyodantai_code <span class=\"token keyword\">for</span> <span class=\"token keyword\">values</span> <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'岩手県'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>実行計画</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">sql</span>文\n<span class=\"token comment\">--------------------------------------------</span>\nSeq Scan <span class=\"token keyword\">on</span> <span class=\"token operator\">&lt;</span>table_name<span class=\"token operator\">></span>  <span class=\"token punctuation\">(</span>cost<span class=\"token operator\">=</span><span class=\"token number\">0.00</span><span class=\"token punctuation\">.</span><span class=\"token number\">.1</span><span class=\"token number\">.60</span> <span class=\"token keyword\">rows</span><span class=\"token operator\">=</span><span class=\"token number\">60</span> width<span class=\"token operator\">=</span><span class=\"token number\">28</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><strong>Scan</strong>\n<ul>\n<li><strong>Index Scan</strong> Index を使った実行</li>\n<li><strong>Seq Scan</strong> フルスキャン</li>\n</ul>\n</li>\n<li><strong>cost</strong> 指標 相対的に評価する</li>\n<li><strong>rows</strong> 実際の操作行数</li>\n<li><strong>width</strong> 取得される行の平均サイズ</li>\n</ul>","frontmatter":{"title":"Postgres 基本コマンド","date":"February 23, 2022","post_modified":"February 23, 2022","description":"Postgres よく使うコマンド これ覚えとけばなんとかなるかな","tags":["Database","Postgres"],"draft":false}},"previous":{"fields":{"slug":"/BackEnd/DB/MySQL/my_ini/"},"frontmatter":{"title":"MySQL の設定ファイル my.ini の項目"}},"next":{"fields":{"slug":"/Environment/Docker/Docker-compose_basic/"},"frontmatter":{"title":"Docker-compose よく使うコマンド"}}},"pageContext":{"id":"7015b7f1-5e79-57cf-b054-4bfc287305d3","previousPostId":"ae8cae24-3eb4-5102-89c0-16f04b3101e9","nextPostId":"1b33a129-d4a4-5d32-9a33-3731829d4dd2","draft":false}},
    "staticQueryHashes": ["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575","3679674316"]}
{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/BackEnd/DB/Function/",
    "result": {"data":{"site":{"siteMetadata":{"title":"おっさんWEBエンジニア奮闘記"}},"markdownRemark":{"id":"774e41e2-6286-5aa1-a49b-5e2a571e99ae","excerpt":"CASE SELECT 句 WHERE 句 GROUP BY 句 INTERSECT 共通するレコード Expect Address にあって Address2 にないレコード Rank age の降順(抜け番あり) age の降順(抜け番なし) SUBSTRING ROWS BETWEEN WITH…","html":"<h2>CASE</h2>\n<p><strong>SELECT 句</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> name<span class=\"token punctuation\">,</span>\n       address<span class=\"token punctuation\">,</span>\n       <span class=\"token keyword\">CASE</span>\n           <span class=\"token keyword\">WHEN</span> address <span class=\"token operator\">=</span> <span class=\"token string\">'東京都'</span> THEM <span class=\"token string\">'関東'</span>\n           <span class=\"token keyword\">WHEN</span> address <span class=\"token operator\">=</span> <span class=\"token string\">'福島県'</span> THEM <span class=\"token string\">'東北'</span>\n           <span class=\"token keyword\">ELSE</span> <span class=\"token boolean\">NULL</span>\n           <span class=\"token keyword\">END</span> <span class=\"token keyword\">AS</span> distrint\n<span class=\"token keyword\">FROM</span> Address</code></pre></div>\n<p><strong>WHERE 句</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">key</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token punctuation\">,</span>\n    date_1<span class=\"token punctuation\">,</span>\n    flg_1<span class=\"token punctuation\">,</span>\n    date_2<span class=\"token punctuation\">,</span>\n    flg_2<span class=\"token punctuation\">,</span>\n    date_3<span class=\"token punctuation\">,</span>\n    flg_3\n<span class=\"token keyword\">FROM</span> ThreeElements\n<span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">CASE</span>\n    <span class=\"token keyword\">WHEN</span> date_1 <span class=\"token operator\">=</span> <span class=\"token string\">'2013-11-01'</span> <span class=\"token keyword\">THEN</span> flg_1\n    <span class=\"token keyword\">WHEN</span> date_2 <span class=\"token operator\">=</span> <span class=\"token string\">'2013-11-01'</span> <span class=\"token keyword\">THEN</span> flg_2\n    <span class=\"token keyword\">WHEN</span> date_3 <span class=\"token operator\">=</span> <span class=\"token string\">'2013-11-01'</span> <span class=\"token keyword\">THEN</span> flg_3\n    <span class=\"token keyword\">ELSE</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">END</span> <span class=\"token operator\">=</span> <span class=\"token string\">'T'</span>\n<span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>GROUP BY 句</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">CASE</span>\n           <span class=\"token keyword\">WHEN</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span> <span class=\"token keyword\">THEN</span> <span class=\"token string\">'子供'</span> <span class=\"token operator\">!</span><span class=\"token keyword\">open</span> <span class=\"token operator\">-</span>a IntelliJ\\ IDEA <span class=\"token operator\">%</span>\n           <span class=\"token keyword\">WHEN</span> age <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">20</span> <span class=\"token operator\">AND</span> <span class=\"token number\">69</span> <span class=\"token keyword\">THEN</span> <span class=\"token string\">'成人'</span>\n           <span class=\"token keyword\">WHEN</span> age <span class=\"token operator\">>=</span> <span class=\"token number\">70</span> <span class=\"token keyword\">THEN</span> <span class=\"token string\">'老人'</span>\n           <span class=\"token keyword\">ELSE</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">END</span> <span class=\"token keyword\">AS</span> age_class<span class=\"token punctuation\">,</span>\n       <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">FROM</span> Persons\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">CASE</span>\n             <span class=\"token keyword\">WHEN</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span> <span class=\"token keyword\">THEN</span> <span class=\"token string\">'子供'</span>\n             <span class=\"token keyword\">WHEN</span> age <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">20</span> <span class=\"token operator\">AND</span> <span class=\"token number\">69</span> <span class=\"token keyword\">THEN</span> <span class=\"token string\">'成人'</span>\n             <span class=\"token keyword\">WHEN</span> age <span class=\"token operator\">>=</span> <span class=\"token number\">70</span> <span class=\"token keyword\">THEN</span> <span class=\"token string\">'老人'</span>\n             <span class=\"token keyword\">ELSE</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>INTERSECT</h2>\n<p><strong>共通するレコード</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> Address <span class=\"token keyword\">INTERSECT</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> Address2<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Expect</h2>\n<p><strong>Address にあって Address2 にないレコード</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> Address <span class=\"token keyword\">EXCEPT</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> Address2<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Rank</h2>\n<p><strong>age の降順(抜け番あり)</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> name<span class=\"token punctuation\">,</span>\n       age<span class=\"token punctuation\">,</span>\n       RANK<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">OVER</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> age <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> rnk</code></pre></div>\n<p><strong>age の降順(抜け番なし)</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> name<span class=\"token punctuation\">,</span>\n       age<span class=\"token punctuation\">,</span>\n       DENSE_RANK<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">OVER</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> age <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> rnk</code></pre></div>\n<h2>SUBSTRING</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> SUBSTRING<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> label<span class=\"token punctuation\">,</span>\n       <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">FROM</span> Persons\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> SUBSTRING<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>ROWS BETWEEN</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 1行前</span>\n<span class=\"token keyword\">SELECT</span> company<span class=\"token punctuation\">,</span>\n       <span class=\"token keyword\">year</span><span class=\"token punctuation\">,</span>\n       sale<span class=\"token punctuation\">,</span>\n       <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>company<span class=\"token punctuation\">)</span>\n           <span class=\"token keyword\">OVER</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> company\n               <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">year</span>\n               <span class=\"token keyword\">ROWS</span> <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">1</span> <span class=\"token keyword\">PRECEDING</span>\n                   <span class=\"token operator\">AND</span> <span class=\"token number\">1</span> <span class=\"token keyword\">PRECEDING</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> pre_company<span class=\"token punctuation\">,</span>\n       <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>sale<span class=\"token punctuation\">)</span>\n           <span class=\"token keyword\">OVER</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> company\n               <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">year</span>\n               <span class=\"token keyword\">ROWS</span> <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">1</span> <span class=\"token keyword\">PRECEDING</span>\n                   <span class=\"token operator\">AND</span> <span class=\"token number\">1</span> <span class=\"token keyword\">PRECEDING</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> pre_sale\n<span class=\"token keyword\">FROM</span> Sales<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>WITH RECURSIVE</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">with</span> recursive calculate_range<span class=\"token punctuation\">(</span>date_start<span class=\"token punctuation\">,</span> date_end<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">select</span> <span class=\"token keyword\">date</span> <span class=\"token string\">'2021-01-01'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">date</span> <span class=\"token string\">'2022-01-31'</span>\n    <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span>\n    <span class=\"token keyword\">select</span> <span class=\"token keyword\">date</span><span class=\"token punctuation\">(</span>date_start <span class=\"token operator\">+</span> <span class=\"token keyword\">interval</span> <span class=\"token string\">'1 month'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">date</span><span class=\"token punctuation\">(</span>date_start <span class=\"token operator\">+</span> <span class=\"token keyword\">interval</span> <span class=\"token string\">'2 month'</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">interval</span> <span class=\"token string\">'1 day'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">from</span> calculate_range\n    <span class=\"token keyword\">where</span> date_start <span class=\"token operator\">&lt;</span> <span class=\"token string\">'2022-01-01'</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span> calculate_range<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> calculate_range</code></pre></div>","frontmatter":{"title":"Database Function 使用頻度高","date":"February 22, 2022","post_modified":"February 22, 2022","description":"使用頻度が高い Database のFunction コピペ用","tags":["Database","MySQL","Postgres"],"draft":false}},"previous":{"fields":{"slug":"/Infrastructure/CICD/GitHub/act_basic/"},"frontmatter":{"title":"act 基本コマンド"}},"next":{"fields":{"slug":"/BackEnd/DB/Join/"},"frontmatter":{"title":"Database Table結合の基本"}}},"pageContext":{"id":"774e41e2-6286-5aa1-a49b-5e2a571e99ae","previousPostId":"10889eea-5ef5-5ac5-99e6-1c5c9ec64d0d","nextPostId":"d59439c7-9e38-51bc-ba2f-039f61829d6e","draft":false}},
    "staticQueryHashes": ["1126706167","1176493165","1188992244","1314910092","1760060771","2772418575"]}